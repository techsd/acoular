<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Fast Fourier Transform (FFT) of multichannel time data. &#8212; Acoular 24.10 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=f63d8bfa" />
    <link rel="stylesheet" type="text/css" href="../../_static/haikuac.css?v=41595bc8" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_gallery.css?v=f3715e10" />
    <script src="../../_static/documentation_options.js?v=62826975"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../_static/acoular_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Tools" href="../tools/index.html" />
    <link rel="prev" title="Parallel processing chains – SampleSplitter buffer handling." href="example_sample_splitter_bufferhandling.html" /> 
  </head><body>
      <div class="header"><img class="rightlogo" src="../../_static/Acoular_logo.png" alt="Logo"/><h1 class="heading"><a href="../../index.html">
          <span>Acoular 24.10 documentation</span></a></h1>
        <h2 class="heading"><span>Fast Fourier Transform (FFT) of multichannel time data.</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="example_sample_splitter_bufferhandling.html">Parallel processing chains – SampleSplitter buffer handling.</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">IO and signal processing examples</a>
        &#160;&#160;::&#160;&#160;
        <a href="../tools/index.html">Tools</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-io-and-signal-processing-examples-example-fft-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="fast-fourier-transform-fft-of-multichannel-time-data">
<span id="sphx-glr-auto-examples-io-and-signal-processing-examples-example-fft-py"></span><h1>Fast Fourier Transform (FFT) of multichannel time data.<a class="headerlink" href="#fast-fourier-transform-fft-of-multichannel-time-data" title="Link to this heading">¶</a></h1>
<p>Demonstrates how to calculate the FFT of a signal blockwise and how to create a spectrogram of the signal.</p>
<p>Imports</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">acoular</span> <span class="k">as</span> <span class="nn">ac</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>We define two sine wave signals with different frequencies (1000 Hz and 4000 Hz) and a noise signal.
Then, the signals are calculated and added together.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">sample_freq</span> <span class="o">=</span> <span class="mi">25600</span>
<span class="n">t_in_s</span> <span class="o">=</span> <span class="mf">30.0</span>
<span class="n">numsamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sample_freq</span> <span class="o">*</span> <span class="n">t_in_s</span><span class="p">)</span>

<span class="n">sine1</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">SineGenerator</span><span class="p">(</span><span class="n">sample_freq</span><span class="o">=</span><span class="n">sample_freq</span><span class="p">,</span> <span class="n">numsamples</span><span class="o">=</span><span class="n">numsamples</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">sine2</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">SineGenerator</span><span class="p">(</span><span class="n">sample_freq</span><span class="o">=</span><span class="n">sample_freq</span><span class="p">,</span> <span class="n">numsamples</span><span class="o">=</span><span class="n">numsamples</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">WNoiseGenerator</span><span class="p">(</span><span class="n">sample_freq</span><span class="o">=</span><span class="n">sample_freq</span><span class="p">,</span> <span class="n">numsamples</span><span class="o">=</span><span class="n">numsamples</span><span class="p">,</span> <span class="n">rms</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">mixed_signal</span> <span class="o">=</span> <span class="p">(</span><span class="n">sine1</span><span class="o">.</span><span class="n">signal</span><span class="p">()</span> <span class="o">+</span> <span class="n">sine2</span><span class="o">.</span><span class="n">signal</span><span class="p">()</span> <span class="o">+</span> <span class="n">noise</span><span class="o">.</span><span class="n">signal</span><span class="p">())[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
</pre></div>
</div>
<p>The mixed signal is then used to create a TimeSamples object.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">TimeSamples</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mixed_signal</span><span class="p">,</span> <span class="n">sample_freq</span><span class="o">=</span><span class="n">sample_freq</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">numsamples</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">numchannels</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>768000 1
</pre></div>
</div>
<section id="create-a-spectrogram-of-the-signal">
<h2>Create a spectrogram of the signal<a class="headerlink" href="#create-a-spectrogram-of-the-signal" title="Link to this heading">¶</a></h2>
<p>Therefore we want to process the FFT spectra of the signal blockwise.
To do so, we use the <a class="reference internal" href="../../api_ref/generated/generated/acoular.fprocess.RFFT.html#acoular.fprocess.RFFT" title="acoular.fprocess.RFFT"><code class="xref py py-class docutils literal notranslate"><span class="pre">acoular.fprocess.RFFT</span></code></a> class, which calculates the FFT spectra of the signal blockwise.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">block_size</span> <span class="o">=</span> <span class="mi">512</span>

<span class="n">fft</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">RFFT</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="n">block_size</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;Rectangular&#39;</span><span class="p">)</span>  <span class="c1"># results in the amplitude spectra</span>

<span class="n">spec</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">fft</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># return a single snapshot</span>
<span class="n">time_block</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">block_size</span><span class="p">))[:,</span> <span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parseval&#39;s theorem:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;signal energy in time domain&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">time_block</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s1">&#39;signal energy in frequency domain (single-sided)&#39;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="n">block_size</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">spec</span> <span class="o">*</span> <span class="n">spec</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()))</span><span class="o">.</span><span class="n">real</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># It can be seen, that the energy is not preserved when using the default &#39;none&#39; scaling.</span>
<span class="c1"># Therefore, we set the scaling to &#39;energy&#39; to compensate for the energy loss due to truncation to a single-sided spectrum.</span>

<span class="n">fft</span><span class="o">.</span><span class="n">scaling</span> <span class="o">=</span> <span class="s1">&#39;energy&#39;</span>
<span class="n">spec</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">fft</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s1">&#39;signal energy in frequency domain (single-sided) with energy scaling&#39;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="n">block_size</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">spec</span> <span class="o">*</span> <span class="n">spec</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">real</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">fft</span><span class="o">.</span><span class="n">scaling</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
<span class="n">ifft</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">IRFFT</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">fft</span><span class="p">)</span>
<span class="n">time_block_rec</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">ifft</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">block_size</span><span class="p">))[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reconstructed signal energy in time domain&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">time_block_rec</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Parseval&#39;s theorem:
signal energy in time domain 1231.0
signal energy in frequency domain (single-sided) 616.0
signal energy in frequency domain (single-sided) with energy scaling 1231.0
reconstructed signal energy in time domain 1231.0
</pre></div>
</div>
<p>Plot the spectrogram (time-frequency representation) of the signal.
Here, we plot the amplitude spectra for each time block. Therefore, we normalize the fft spectra
by the number of samples in the block by setting the <code class="xref py py-attr docutils literal notranslate"><span class="pre">scaling</span></code> to <code class="code docutils literal notranslate"><span class="pre">'amplitude'</span></code>.
It can be varified from the spectrogram plot that the amplitude of the tones are correctly represented.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fft</span><span class="o">.</span><span class="n">scaling</span> <span class="o">=</span> <span class="s1">&#39;amplitude&#39;</span>
<span class="n">spectrogram</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">return_result</span><span class="p">(</span><span class="n">fft</span><span class="p">)</span>

<span class="c1"># plot the power spectrogram</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">spectrogram</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t_in_s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sample_freq</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time / s&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency / Hz&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Power Spectrum&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">block_size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4096</span><span class="p">,</span> <span class="mi">256</span><span class="p">]:</span>
    <span class="n">fft</span><span class="o">.</span><span class="n">block_size</span> <span class="o">=</span> <span class="n">block_size</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">fft</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fft</span><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">spec</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;block_size = </span><span class="si">{</span><span class="n">block_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_freq</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency / Hz&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude Spectrum&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img src="../../_images/sphx_glr_example_fft_001.png" srcset="../../_images/sphx_glr_example_fft_001.png" alt="example fft" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_example_fft_002.png" srcset="../../_images/sphx_glr_example_fft_002.png" alt="example fft" class = "sphx-glr-multi-img"/></li>
</ul>
</section>
<section id="create-an-averaged-power-spectral-density-of-the-signal">
<h2>Create an averaged power spectral density of the signal<a class="headerlink" href="#create-an-averaged-power-spectral-density-of-the-signal" title="Link to this heading">¶</a></h2>
<p>To calculate the time averaged power spectral density of the signal, we use the <a class="reference internal" href="../../api_ref/generated/generated/acoular.fprocess.AutoPowerSpectra.html#acoular.fprocess.AutoPowerSpectra" title="acoular.fprocess.AutoPowerSpectra"><code class="xref py py-class docutils literal notranslate"><span class="pre">acoular.fprocess.AutoPowerSpectra</span></code></a> class.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fft</span><span class="o">.</span><span class="n">scaling</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
<span class="n">ap</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">AutoPowerSpectra</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">fft</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="s1">&#39;psd&#39;</span><span class="p">)</span>  <span class="c1"># results in the power spectrum</span>
<span class="n">avg</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">Average</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ap</span><span class="p">,</span> <span class="n">naverage</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>  <span class="c1"># results in the time averaged power spectrum</span>
</pre></div>
</div>
<p>Plot the resulting power spectrum for different number of averages.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">block_size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">fft</span><span class="o">.</span><span class="n">block_size</span> <span class="o">=</span> <span class="n">block_size</span>
    <span class="k">for</span> <span class="n">navg</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">]:</span>
        <span class="n">avg</span><span class="o">.</span><span class="n">naverage</span> <span class="o">=</span> <span class="n">navg</span>
        <span class="n">spectrum</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">avg</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">L_p</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fft</span><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;navg = </span><span class="si">{</span><span class="n">navg</span><span class="si">}</span><span class="s1">, block_size = </span><span class="si">{</span><span class="n">block_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency / Hz&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PSD / dB&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img src="../../_images/sphx_glr_example_fft_003.png" srcset="../../_images/sphx_glr_example_fft_003.png" alt="example fft" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_example_fft_004.png" srcset="../../_images/sphx_glr_example_fft_004.png" alt="example fft" class = "sphx-glr-multi-img"/></li>
</ul>
</section>
<section id="create-a-cross-spectral-matrix-for-multichannel-signals">
<h2>Create a cross-spectral matrix for multichannel signals<a class="headerlink" href="#create-a-cross-spectral-matrix-for-multichannel-signals" title="Link to this heading">¶</a></h2>
<p>To calculate the cross-spectral matrix of the signal, we use the <a class="reference internal" href="../../api_ref/generated/generated/acoular.fprocess.CrossPowerSpectra.html#acoular.fprocess.CrossPowerSpectra" title="acoular.fprocess.CrossPowerSpectra"><code class="xref py py-class docutils literal notranslate"><span class="pre">acoular.fprocess.CrossPowerSpectra</span></code></a> class.
First, we create a TimeSamples object with two channels.
Then, we calculate the cross-spectral matrix of the signal blockwise. We choose
a normalization method of ‘psd’ (Power Spectral Density) for the cross-spectral matrix.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fft</span><span class="o">.</span><span class="n">block_size</span> <span class="o">=</span> <span class="mi">128</span>

<span class="n">mixed_signal</span> <span class="o">=</span> <span class="n">noise</span><span class="o">.</span><span class="n">signal</span><span class="p">()[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">TimeSamples</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">mixed_signal</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">mixed_signal</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">sample_freq</span><span class="o">=</span><span class="n">sample_freq</span><span class="p">)</span>

<span class="c1"># compare with PowerSpectra</span>
<span class="n">ps1</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">PowerSpectra</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="n">fft</span><span class="o">.</span><span class="n">block_size</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">csm_comp</span> <span class="o">=</span> <span class="n">ps1</span><span class="o">.</span><span class="n">csm</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>

<span class="n">fft</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">ts</span>  <span class="c1"># we need to change the source of the fft object to the new TimeSamples object</span>
<span class="n">ps</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">CrossPowerSpectra</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">fft</span><span class="p">)</span>
<span class="n">avg</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">Average</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ps</span><span class="p">,</span> <span class="n">naverage</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ps1</span><span class="o">.</span><span class="n">num_blocks</span><span class="p">))</span>
<span class="n">csm</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">avg</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># reshape the cross-spectral matrix to a 3D array of shape (numfreq, numchannels, numchannels)</span>
<span class="n">csm</span> <span class="o">=</span> <span class="n">csm</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">fft</span><span class="o">.</span><span class="n">numfreqs</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">numchannels</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">numchannels</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot both spectra</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">numchannels</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">auto_pow_spectrum</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">L_p</span><span class="p">(</span><span class="n">csm_comp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fft</span><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">auto_pow_spectrum</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;PowerSpectra (</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">auto_pow_spectrum</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">L_p</span><span class="p">(</span><span class="n">csm</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fft</span><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">auto_pow_spectrum</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;CrossPowerSpectra (</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency / Hz&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Power Spectrum / dB&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_example_fft_005.png" srcset="../../_images/sphx_glr_example_fft_005.png" alt="example fft" class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 2.497 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-io-and-signal-processing-examples-example-fft-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/bf05ff1c4ae60a089a665cf90beaef77/example_fft.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">example_fft.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/a8b1d83458dba316ca9a994bc3be65cd/example_fft.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">example_fft.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/60168c25f91f9919bea215fabea6bf0a/example_fft.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">example_fft.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="example_sample_splitter_bufferhandling.html">Parallel processing chains – SampleSplitter buffer handling.</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">IO and signal processing examples</a>
        &#160;&#160;::&#160;&#160;
        <a href="../tools/index.html">Tools</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Acoular Development Team.
      Last updated on Oct 23, 2024.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>